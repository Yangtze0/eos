
**Table of Contents**
- [Introduction](#introduction)
- [Set up Benchmark Account](#set-up-benchmark-account)
- [Fund Benchmark Accounts and Run Benchmark](#fund-benchmark-accounts-and-run-benchmark)
- [Analyzing Performance](#analyzing-performance)

## Introduction
The following benchmark is intended to be done on isolated private testnet. Please set up your private testnet before continue. Running the benchmark on a public testnet might not give appropriate figures as the public testnet might also being used by other people when the benchmark is being performed.

eosc supports sending a continuous batch of transfer transaction between 2 or more accounts in order to measure how many transactions can be processed by the blockchain per block. The steps that need to be performed are:
1. Setup 2 or more accounts whom we are going to perform the transfer transactions between
2. Fund these benchmark accounts
3. Perform random transfer transactions between these benchmark accounts

The following guide will assume that you have eosd running on your localhost port 8888.

## Set up Benchmark Account
To set up benchmark account, ensure that you have `inita` private key in your wallet and then run the following command:
```
$ eosc benchmark setup ${num_of_benchmark_accounts} ${benchmark_account_owner_pub_key} ${benchmark_account_active_pub_key}
```
For example
```
$ eosc benchmark setup 10 EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
```
This will generate 10 benchmark accounts under `inita`, you can check it via the following command
```
$ eosc get servants inita
{
  "controlled_accounts": [
    "benchmark",
    "benchmark...1",
    "benchmark...2",
    "benchmark...3",
    "benchmark...4",
    "benchmark...5",
    "benchmark...a",
    "benchmark...b",
    "benchmark...c",
    "benchmark...d"
  ]
}
```

## Fund Benchmark Accounts and Run Benchmark
Ensure that you have private key of ${benchmark_account_active_pub_key} imported to your wallet. Then to fund benchmark accounts and run benchmark, execute the following command
```
$ eosc benchmark transfer ${num_of_benchmark_accounts_to_transfer_among} ${num_of_transfers_to_execute} ${loop_or_not}
```
Note that ${num_of_benchmark_accounts_to_transfer_among} need to be less or equal than the number of benchmark accounts that you set up in the previous step

For example:
```
$ eosc benchmark transfer 10 1000 0
```
This will first fund 10 benchmark accounts with money from `initb`, and then perform 1000 transactions among these 10 accounts. In total, there will be 1010 transactions generated by this command.

## Analyzing Performance
Let's execute
```
$ eosc benchmark transfer 10 1000 0
```
Once you start the benchmark, you will see a lot of transactions coming to your eosd. Take a look at your eosd output and you will likely see:
```
2402047ms            chain_controller.cpp:208      _push_block          ] inith #6539 @2017-12-07T08:40:02  | 0 trx, 0 pending, exectime_ms=42
2402047ms            producer_plugin.cpp:246       block_production_loo ] inith generated block #6539 @ 2017-12-07T08:40:02 with 0 trxs  0 pending
2404003ms            chain_controller.cpp:208      _push_block          ] inito #6540 @2017-12-07T08:40:04  | 0 trx, 0 pending, exectime_ms=0
2404003ms            producer_plugin.cpp:246       block_production_loo ] inito generated block #6540 @ 2017-12-07T08:40:04 with 0 trxs  0 pending
2406002ms            chain_controller.cpp:208      _push_block          ] initf #6541 @2017-12-07T08:40:06  | 0 trx, 0 pending, exectime_ms=0
2406002ms            producer_plugin.cpp:246       block_production_loo ] initf generated block #6541 @ 2017-12-07T08:40:06 with 0 trxs  0 pending
2408072ms            chain_controller.cpp:375      _generate_block      ] generation took 70 ms
2408101ms            chain_controller.cpp:208      _push_block          ] initk #6542 @2017-12-07T08:40:08  | 60 trx, 0 pending, exectime_ms=27
2408101ms            producer_plugin.cpp:246       block_production_loo ] initk generated block #6542 @ 2017-12-07T08:40:08 with 60 trxs  0 pending
2410049ms            chain_controller.cpp:375      _generate_block      ] generation took 46 ms
2410078ms            chain_controller.cpp:208      _push_block          ] initn #6543 @2017-12-07T08:40:10  | 60 trx, 0 pending, exectime_ms=26
2410079ms            producer_plugin.cpp:246       block_production_loo ] initn generated block #6543 @ 2017-12-07T08:40:10 with 60 trxs  0 pending
2412050ms            chain_controller.cpp:375      _generate_block      ] generation took 48 ms
2412080ms            chain_controller.cpp:208      _push_block          ] initt #6544 @2017-12-07T08:40:12  | 60 trx, 0 pending, exectime_ms=28
2412081ms            producer_plugin.cpp:246       block_production_loo ] initt generated block #6544 @ 2017-12-07T08:40:12 with 60 trxs  0 pending
2414069ms            chain_controller.cpp:375      _generate_block      ] generation took 63 ms
2414095ms            chain_controller.cpp:208      _push_block          ] initb #6545 @2017-12-07T08:40:14  | 60 trx, 0 pending, exectime_ms=23
2414095ms            producer_plugin.cpp:246       block_production_loo ] initb generated block #6545 @ 2017-12-07T08:40:14 with 60 trxs  0 pending
2416005ms            chain_controller.cpp:208      _push_block          ] initc #6546 @2017-12-07T08:40:16  | 0 trx, 0 pending, exectime_ms=0
2416005ms            producer_plugin.cpp:246       block_production_loo ] initc generated block #6546 @ 2017-12-07T08:40:16 with 0 trxs  0 pending
2418004ms            chain_controller.cpp:208      _push_block          ] initr #6547 @2017-12-07T08:40:18  | 0 trx, 0 pending, exectime_ms=0
```
The above snippet is taken for running the benchmark on a single local eosd node with block interval 2 seconds and pending transactions limit 60.

From the above snippet, we can make the following analysis:
- Total Time = 3 blocks (6 seconds)
- Total Transactions = 10 (funding) + 1000 (transfer) = 1100 transactions
- Successful Transactions = 60 + 60 + 60 = 180
- Rejected Transactions = 1100 - (60 + 60 + 60) = 920 (remember that we cap the pending transactions queue to 60)
- Transactions per second =  average (transactions per block / block interval) = ((60 + 60 + 60) / 2) / 3 = 30 tps



